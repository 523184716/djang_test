{% extends "layout/apycenter.html" %}

    {% block content %}

<script src="{{ url_for('static', filename='assets/js/echarts.min.js') }}"></script>

<div class="am-modal am-modal-alert" tabindex="-1" id="set-filed">
  <div class="am-modal-dialog">
    <div class="am-modal-hd">自定义字段</div>
    <div class="am-modal-bd">
     
     <div class="am-g am-text-left">

      <div class="am-u-sm-4" style="margin-left:6%" >
        
                <label class="am-checkbox">
                  <input type="checkbox" value="id" class="filed" commet="序号" data-am-ucheck name="checkfield"> 序号
                </label>
                

                <label class="am-checkbox">
                  <input type="checkbox" value="revision" class="filed" commet="版本号" data-am-ucheck name="checkfield"> 版本号
                </label>
                

                <label class="am-checkbox">
                  <input type="checkbox" value="author" class="filed" commet="提交账号" data-am-ucheck name="checkfield"> 提交账号
                </label>
                   
      </div>

      <div class="am-u-sm-3" >
        
                <label class="am-checkbox">
                  <input type="checkbox" value="date" class="filed" commet="提交时间" data-am-ucheck name="checkfield"> 提交时间
                </label>
                

                <label class="am-checkbox">
                  <input type="checkbox" value="msg" class="filed" commet="提交注释" data-am-ucheck name="checkfield"> 提交注释
                </label>
                

                <label class="am-checkbox">
                  <input type="checkbox" value="paths" class="filed" commet="提交文件" data-am-ucheck name="checkfield"> 提交文件
                </label>
                    
      </div>  

      <div class="am-u-sm-3" >
        
                <label class="am-checkbox">
                  <input type="checkbox" value="count" class="filed" commet="提交数量" data-am-ucheck name="checkfield"> 提交数量
                </label>
                

                <label class="am-checkbox">
                  <input type="checkbox" value="task_id" class="filed" commet="任务ID" data-am-ucheck name="checkfield"> 任务ID
                </label>
                

                <label class="am-checkbox">
                  <input type="checkbox" value="lasted_update" class="filed" commet="更新时间" data-am-ucheck name="checkfield"> 更新时间
                </label>
                

                    <label class="am-checkbox">
                      <input type="checkbox" value="project_id" class="filed" commet="项目ID" data-am-ucheck name="checkfield"> 项目ID
                    </label>
                    

                    <label class="am-checkbox">
                      <input type="checkbox" value="project_name" class="filed" commet="项目名称" data-am-ucheck name="checkfield"> 项目名称
                    </label>
                    
      </div>


    </div>


  </div>
  <div class="am-modal-footer">
    <span class="am-modal-btn" id="set-filed-sure">确定</span>
    <span class="am-modal-btn">取消</span>
  </div>
</div>
</div>


    <div class="am-modal am-modal-confirm" tabindex="-1" id="my-confirm">
      <div class="am-modal-dialog">
        <div class="am-modal-hd">提示</div>
        <div class="am-modal-bd">
           确定要删除选中的记录？
      </div>
      <div class="am-modal-footer">
          <span class="am-modal-btn" data-am-modal-cancel>取消</span>
          <span class="am-modal-btn" data-am-modal-confirm>确定</span>
      </div>
    </div>
    </div>


            <div class="tpl-content-wrapper">
                <div class="row-content am-cf">
                    <div class="row">
                        <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                            <div class="widget am-cf">


                                        <div style="margin-top:20px;margin-bottom:12px;">
                                          <div class="am-btn-toolbar">
                                            <div class="am-btn-group am-btn-group-xs am-u-sm-12 am-u-md-12 am-u-lg-12">
                                              
                                              <span style="float:left;display:inline;margin-right:30px" class="am-icon-hand-o-right"> 代码统计和分析 </span>
                                              <div class="am-form-group tpl-table-list-select" style="display:inline;">
                                              <select data-am-selected="{btnWidth: '90px', btnSize: 'sm'}" id="js-selected-yewu">
                                                <option value="zzb">掌中保</option>
                                                <option value="czhan">意健险</option>
                                              </select>
                                              </div>

                                              <div class="am-form-group tpl-table-list-select" style="display:inline;">
                                              <select data-am-selected="{btnWidth: '128px', btnSize: 'sm'}" id="js-selected-project">
                                                <option value="1">[cm]bug分支</option>
                                                <option value="2">[cm]需求分支</option>
                                              </select>
                                              </div>                        
                                              
                                              <button type="button" class="am-btn am-btn-default am-btn-xs svn-view "  style="background:white;height:32px;" ><a href="javascript:;">概览</a></button>                           
                                              <button type="button" class="am-btn am-btn-default am-btn-xs svn-top10 "  style="background:white;height:32px;" ><a href="javascript:;">Top10统计</a></button>
                                              <button type="button" class="am-btn am-btn-default am-btn-xs svn-developers "  style="background:white;height:32px;" ><a href="javascript:;">开发者统计</a></button>
                                              <button type="button" class="am-btn am-btn-default am-btn-xs svn-codes "  style="background:white;height:32px;" ><a href="javascript:;">代码量统计</a></button>
                                              <button type="button" class="am-btn am-btn-default am-btn-xs svn-commits "  style="background:white;height:32px;" ><a href="javascript:;">Commits统计</a></button>                                      
                                                                                 
                                              

                                            </div>
                                          </div>
                                        </div>
                                      


                                <div class="widget-body  am-fr" id="background">

                                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                                        <div class="am-form-group">
                                            <div class="am-btn-toolbar">
                                                <div class="am-btn-group am-btn-group-xs" style="width:100%">

                                                  <div class="am-alert am-alert-danger" id="my-alert-date" style="display: none">
                                                    <p>开始日期应小于结束日期！</p>
                                                  </div>
                                                  <div class="am-g" style="width:100%">

                                                    <div  style="display:inline-block;float:left;margin-left:6.78px">
                                                      <button type="button" class="am-btn   am-btn-{{data.action}} am-btn-xs " style="display:inline-block;" id="svn_statics_commits">Commit统计</button>
                                                      <button type="button" class="am-btn   am-btn-secondary am-btn-xs " style="display:inline-block;" id="svn_last">最近提交</button>
                                                      <button type="button" class="am-btn   am-btn-secondary am-btn-xs " style="display:inline-block;" id="svn_src_data">原始数据</button>
                                                    </div>

                                                    <div  style="display:inline-block;float:right;margin-left:6.78px">
                                                      <button type="button" class="am-btn   am-btn-secondary am-btn-xs " id="my-end" style="display:inline-block;">结束日期</button>
                                                      <button type="button" class="am-btn am-btn-default am-btn-xs "  style="background:white;display:inline-block"  disabled><span id="my-endDate">2017-03-22</span></button>

                                                      <button type="button" class="am-btn   am-btn-warning am-btn-xs " style="display:inline-block;" id="svn_last">搜索</button>
                                                    </div>

                                                    <div  style="display:inline-block;float:right;">
                                                      <button type="button" class="am-btn  am-btn-secondary am-btn-xs " id="my-start" style="display:inline-block;">开始日期</button>
                                                      <button type="button" class="am-btn am-btn-default am-btn-xs "  style="background:white;display:inline-block;"  disabled><span id="my-startDate">2017-01-01</span></button>
                                                    </div>


                                                  </div>


                                              <!--       <button type="button" class="am-btn am-btn-default am-btn-success" id="host-create" ><span class="am-icon-plus"></span> 新增</button>
                                                    <button type="button" id="delete" class="am-btn am-btn-default am-btn-danger"><span class="am-icon-trash-o"></span> 删除</button>
                                                    <button type="button" class="am-btn am-btn-default am-btn-warning"><span class="am-icon-upload"></span> 导入 </button>
                                                    <button type="button" class="am-btn am-btn-default am-btn-secondary"><span class="am-icon-download"></span> 导出 </button> -->


                                                </div>
                                            </div>
                                        </div>
                                    </div>

<!--                                     <div class="am-u-sm-12 am-u-md-12 am-u-lg-4">
                                        <div class="am-input-group am-input-group-sm tpl-form-border-form cl-p">
                                            <input type="text" class="am-form-field am-input-sm" id="searchval" placeholder="搜索" value= 
                                              {% if data.search != False  %}
                                              {{ data.search }}
                                              {% endif %}
                                              >
                                            <span class="am-input-group-btn">
                                                <button class="am-btn  am-btn-default am-btn-success tpl-table-list-field am-icon-search" id="searchbtn" type="button"></button>
                                            </span>
                                            <span class="am-input-group-btn">
                                                <button class="am-btn  am-btn-default am-btn-secondary tpl-table-list-field am-icon-cog" type="button" style="margin-left:5px" id="set-fileds"></button>
                                            </span>
                                        </div>
                                    </div> -->


                                    <div class="am-u-lg-6 am-cf" id="wrapper" style="display:inline-block;margin-top:30px;">

                                      <ul class="am-list am-list-static container" id="topappend"  >

                                        
                                        <li>

                                          <strong style="color:#999;display:inline">Top贡献者</strong>
                                         
                                       </li>

                                       
<!--                                         <li>
                                          <span class="am-badge am-badge-secondary">Commits: 23</span>
                                          <img src="{{ url_for('static', filename='assets/img/119746_lookingdreamer.jpg')}}"  widht="20" height="20" style="border-radius:50%;display:inline" >
                                          <span style="color:#999;display:inline">昵称</span>
                                       </li> -->


                                     </ul>

                                    </div>

                                    <div id="main" class="am-u-lg-6" style="height:400px;display:inline-block;margin-top:30px"></div>
                                    <div id="main-two" style="width: 100%;height:400px;display:inline-block;"></div>




                </div>










                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>




    <script src="{{ url_for('static', filename='js/clipboard.min.js') }}"></script>
   


      <script type="text/javascript">

        $.ajax({
         type: "POST",
         url: "svn_commits_statics",
         cache: false,
         data: {'json':1},
         dataType: "json",
         success: function(res){
          console.log(res);
          // console.log(res.name.daihuaqiao);
          var topArray = new Array();
          jQuery.each(res.sum_dict, function(i1, val1) { 

            jQuery.each(res.name, function(k, value) {   
              if ( val1[0] == k ) {
                name = value ;
              }
            }) 

            var strVar = "";
            strVar += "<li>\n";
            strVar += "<span class=\"am-badge am-badge-secondary top_sum\" value="+ val1[1] +" >Commits:"+val1[1]+"<\/span>\n";
            strVar += "<img src=\"{{ url_for('static', filename='assets/img/119746_lookingdreamer.jpg')}}\" widht=\"20\" height=\"20\" style=\"border-radius:50%;display:inline\">\n";
            strVar += "<span style=\"color:#999;display:inline\">"+name+"<\/span>\n";
            strVar += "<\/li>\n";
            topArray.push(strVar);
          })

          var restr =topArray.join(""); 
          var $restr = $(restr) ;  
          var $retable = $("#topappend");  
          $retable.append($restr); 


       var echarts_x_lsit = res.xj_value;
       var echarts_y_lsit = res.yj_value;
       console.log(echarts_x_lsit);

          //--------start

        var myChart = echarts.init(document.getElementById('main'));

        // 指定图表的配置项和数据
        var option = {
          title: {
            text: 'cm Commits次数统计',
            subtext: 'bug分支'
          },
          tooltip: {
            trigger: 'axis'
          },
          toolbox: {
            show: true,
            feature: {
              dataZoom: {
                yAxisIndex: 'none'
              },
              dataView: {readOnly: false},
              magicType: {type: ['line', 'bar']},
              restore: {},
              saveAsImage: {}
            }
          },
          legend: {
            data:['提交次数']
          },
          xAxis: {
            data: res.xj_value
          },
          yAxis: {},
          series: [{
            name: '提交次数',
            type: 'bar',
            data: res.yj_value,
            markPoint: {
              data: [
              {type: 'max', name: '最大值'},
              {type: 'min', name: '最小值'}
              ]
            },
            markLine: {
              data: [
              {type: 'average', name: '平均值'}
              ]
            },
          }]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);




          //--------end

          var user = new Array();
          var topArray = new Array();
          jQuery.each(res.name, function(k, value) {   
              user.push(value);
          })

         data  = new Array()
      //解析返回数据
      jQuery.each(res.data, function(i, val) {  
          series = {} 
          // {
          //   name: '张三',
          //   type: 'line',
          //   data: [5, 20, 36, 10, 10, 20],
          //   markPoint: {
          //     data: [
          //     {type: 'max', name: '最大值'},
          //     {type: 'min', name: '最小值'}
          //     ]
          //   },
          // }
          // series.name = i
          var y = new Array();
          jQuery.each(res.name, function(k, value) {   
            if ( i == k ) {
              series.name = value ;
            }
          })

          jQuery.each(val.xy, function(k1, value1) {   
            y.push(value1[1])
          })
          series.data = y ;

          series.type = 'line';
          series.markPoint = {
            data: [
            {type: 'max', name: '最大值'},
            {type: 'min', name: '最小值'}
            ]
          };

            // console.log(i) ;
            // console.log(series);
            data.push(series)
            // console.log(strVar);

          });



          // $('#asc').click(function() {
          //   sortByInput(asc);
          // });        



           var myChart = echarts.init(document.getElementById('main-two'));

            // 指定图表的配置项和数据
            var option = {
              title: {
                text: 'cm 用户Commits次数统计',
                subtext: 'bug分支'
              },
              tooltip: {

                trigger: 'axis'
              },
              toolbox: {
                show: true,
                feature: {
                  dataZoom: {
                    yAxisIndex: 'none'
                  },
                  dataView: {readOnly: false},
                  magicType: {type: ['line', 'bar']},
                  restore: {},
                  saveAsImage: {}
                }
              },
              legend: {
                data:user,
                left:'25%',
                right:'25%',
              },
              xAxis: {
                data: echarts_x_lsit
              },
              yAxis: {},
              series: data
            };

            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);  

          console.log(data);


        },
        error:function(){     
          $("#msgtips").html('请求数据失败!');  
          $('#my-alert').modal('open');     
        } 
      });


    </script> 

    <script>

    var btns = document.querySelectorAll('button');
    var clipboard = new Clipboard(btns);

    clipboard.on('success', function(e) {
      console.log(e);
      $('#my-prompt').modal('close');
      $("#msgtips").html('复制成功,快去粘贴吧!');  
      $('#my-alert').modal('open');
    });

    clipboard.on('error', function(e) {
        $("#msgtips").html('复制失败,请手工复制!');  
        $('#my-alert').modal('open'); 
        console.log(e);
    });



    var background_color = $("#background").css("background-color"); 
    $(".changebackground").css("background-color",background_color);


    $('.svn-commits').css("background-color","#D8EBFF");
    $('.svn-commits').css("border-color","#71A9E0");      


    $(function() {

      var $selected = $('#js-selected');
      $selected.on('change', function() {
        var button_display = $(this).find('option').eq(this.selectedIndex).text();
        var button_value = $(this).val();
        var limit = $("#limit").val();
        var search = $("#search").val();
        var env = $("#env-selected").val();
        offset = ( button_value - 1  ) * limit ;
        if (search != 'False'){
            location.href = "svn_commits?offset="+offset+"&page="+button_value+"&limit="+limit+"&search="+search;
        }else{
            location.href = "svn_commits?offset="+offset+"&page="+button_value+"&limit="+limit;
        }
      });


    var startDate = new Date(2017, 01, 01);
    var endDate = new Date(2017, 3, 22);
    var $alert = $('#my-alert-date');
    $('#my-start').datepicker().
      on('changeDate.datepicker.amui', function(event) {
        if (event.date.valueOf() > endDate.valueOf()) {
          $alert.find('p').text('开始日期应小于结束日期！').end().show();
        } else {
          $alert.hide();
          startDate = new Date(event.date);
          $('#my-startDate').text($('#my-start').data('date'));
        }
        $(this).datepicker('close');
      });

    $('#my-end').datepicker().
      on('changeDate.datepicker.amui', function(event) {
        if (event.date.valueOf() < startDate.valueOf()) {
          $alert.find('p').text('结束日期应大于开始日期！').end().show();
        } else {
          $alert.hide();
          endDate = new Date(event.date);
          $('#my-endDate').text($('#my-end').data('date'));
        }
        $(this).datepicker('close');
      });



      $("#svn_src_data").click(function(){ 
        location.href="svnderecord";
      })

      $("#svn_last").click(function(){ 
        location.href="svn_commits?action=svn_last";
      })

    
    $("#set-fileds").click(function(){ 
      var obj_th = $(".th-title");//选择所有name="th-title"的对象，返回数组
      var s='';//如果这样定义var s;变量s中会默认被赋个null值
      var tharr = new Array();
      for(var i=0;i<obj_th.length;i++){
        tharr.push($.trim($(obj_th[i]).text()));
      }
      console.log(tharr);

      var obj = document.getElementsByName("checkfield");//选择所有name="checkfield"的对象，返回数组
      var s='';//如果这样定义var s;变量s中会默认被赋个null值
      var no_math_arr = new Array();
      var commetarr = new Array();
      for(var i=0;i<obj.length;i++){
        // console.log($.trim($(obj[i]).attr("commet")));
        if ($.inArray($.trim($(obj[i]).attr("commet")), tharr) != -1 ) {
          $(obj[i]).uCheck('check');
        }else{
          no_math_arr.push($.trim($(obj[i]).attr("commet")));
        }
      }

      if ( no_math_arr.length + obj_th.length != obj.length  ) {
        console.log("还有字段未被对应,请检查列表名称和表格名称是否正确,默认需要显示字段:"+tharr+"未被显示的字段:"+no_math_arr);
      }
      $('#set-filed').modal('open');
    });

    
    $("#set-filed-sure").click(function(){ 
      var obj = document.getElementsByName("checkfield");//选择所有name="checkfield"的对象，返回数组
      var s='';//如果这样定义var s;变量s中会默认被赋个null值
      var checkarr = new Array();
      var commetarr = new Array();
      for(var i=0;i<obj.length;i++){
        if(obj[i].checked) //取到对象数组后，我们来循环检测它是不是被选中
          if (obj[i].value !== '') {
                s+=obj[i].value+',';   //如果选中，将value添加到变量s中
                checkarr.push(obj[i].value);
                commetarr.push($.trim($(obj[i]).attr("commet")));
              };               
            }
      if ( checkarr.length == 0 ) {
            $("#msgtips").html('自定义字段不能为空!');  
            $('#my-alert').modal('open'); 
            return;   
      }
      console.log(checkarr);
      console.log(commetarr);


      var $selected = $('#js-selected');
      var select_value = $selected.val();
      var limit = $("#limit").val();
      var search = $("#search").val();
      var env = $("#env-selected").val();
      if (search != 'False'){
      location.href = "svn_commits?offset="+0+"&page="+1+"&limit="+limit+"&search="+search+"&fields="+checkarr+"&filedcns="+commetarr;
      }else{
      location.href = "svn_commits?offset="+0+"&page="+1+"&limit="+limit+"&fields="+checkarr+"&filedcns="+commetarr;
      } 

    });


    $('.pre_page').click(function () {
        var $selected = $('#js-selected');
        var select_value = $selected.val();
        var limit = $("#limit").val();
        var search = $("#search").val();
        var env = $("#env-selected").val();
        page = parseInt(select_value) - 1 ;
        offset = ( page - 1  ) * limit ;
        if (page > 1){
            if (search != 'False'){
            location.href = "svn_commits?offset="+offset+"&page="+page+"&limit="+limit+"&search="+search;
            }else{
            location.href = "svn_commits?offset="+offset+"&page="+page+"&limit="+limit;    
            }       
        }else{
            if (search != 'False'){
            location.href = "svn_commits?offset="+0+"&page="+1+"&limit="+limit+"&search="+search;
            }else{
            location.href = "svn_commits?offset="+0+"&page="+1+"&limit="+limit;    
            }   
        }

    });

    $('.first_page').click(function () {
        var $selected = $('#js-selected');
        var select_value = $selected.val();
        var limit = $("#limit").val();
        var search = $("#search").val();
        var env = $("#env-selected").val();
        if (search != 'False'){
        location.href = "svn_commits?offset="+0+"&page="+1+"&limit="+limit+"&search="+search;
        }else{
        location.href = "svn_commits?offset="+0+"&page="+1+"&limit="+limit;
        }   
    });

    $('.next_page').click(function () {
        var $selected = $('#js-selected');
        var select_value = $selected.val();
        var limit = $("#limit").val();
        var pages = $("#pages").val();
        var search = $("#search").val();
        var env = $("#env-selected").val();
        max_page = pages - 1 ;
        page = ( parseInt(select_value) + 1) ;
        offset = ( page - 1  ) * limit ;
        if (page < max_page){
            if (search != 'False'){
            location.href = "svn_commits?offset="+offset+"&page="+page+"&limit="+limit+"&search="+search;
            }else{
            location.href = "svn_commits?offset="+offset+"&page="+page+"&limit="+limit; 
            }        
        }else{
            offset = ( max_page - 1  ) * limit ;
            if (search != 'False'){
            location.href = "svn_commits?offset="+offset+"&page="+max_page+"&limit="+limit+"&search="+search;
            }else{
            location.href = "svn_commits?offset="+offset+"&page="+max_page+"&limit="+limit;  
            }   
        }

    });

    $('.last_page').click(function () {
        var $selected = $('#js-selected');
        var select_value = $selected.val();
        var limit = $("#limit").val();
        var pages = $("#pages").val();
        var search = $("#search").val();
        var env = $("#env-selected").val();
        page = pages - 1 ;
        offset = ( page - 1  ) * limit ;
        if (page > 1){
            if (search != 'False'){
            location.href = "svn_commits?offset="+offset+"&page="+page+"&limit="+limit+"&search="+search;
            }else{
            location.href = "svn_commits?offset="+offset+"&page="+page+"&limit="+limit;
            }       
        }else{
            if (search != 'False'){
            location.href = "svn_commits?offset="+0+"&page="+1+"&limit="+limit+"&search="+search;
            }else{
            location.href = "svn_commits?offset="+0+"&page="+1+"&limit="+limit;
            }   
        } 
    });

    $('#searchbtn').click(function () {
        var $selected = $('#js-selected');
        var select_value = $selected.val();
        var limit = $("#limit").val();
        var search = $("#searchval").val();
        var env = $("#env-selected").val();
        if (search != 'False'){
        location.href = "svn_commits?offset="+0+"&page="+1+"&limit="+limit+"&search="+search;
        }else{
        location.href = "svn_commits?offset="+0+"&page="+1+"&limit="+limit;   
        }   
    });


    $('#host-create').click(function () {
        location.href="svn_commits_create";  
    });


    //删除选中的值
    $("#delete").click(function(){ 
        var obj = document.getElementsByName("checkbox");//选择所有name="checked"的对象，返回数组
        var s='';//如果这样定义var s;变量s中会默认被赋个null值
        var checkarr = new Array();
        for(var i=0;i<obj.length;i++){
            if(obj[i].checked) //取到对象数组后，我们来循环检测它是不是被选中
                if (obj[i].value !== '') {
                    s+=parseInt(obj[i].value)+',';   //如果选中，将value添加到变量s中
                    checkarr.push(obj[i].value);
                };               
        }
        if ( checkarr.length == 0 ) {
                $("#msgtips").html('没有选中任何记录,请重新选择!');  
                $('#my-alert').modal('open');
                return ;        
        } 

        function reload(){
         location.reload();
        }
     

        $('#my-confirm').modal({
            relatedTarget: this,
            onConfirm: function(options) {
                $.ajax({
                 type: "POST",
                 url: "/api/svn_commits/delete",
                 cache: false,
                 data: {'ids':s},
                 dataType: "json",
                 success: function(res){
                    console.log(res);

                    if ( res.rc == 1 ) {
                        $("#msgtips").html('删除成功!');  
                        $('#my-alert').modal('open');
                         location.reload();
                    }else{
                        $("#msgtips").html('删除失败!');  
                        $('#my-alert').modal('open');       
                    }

                },
                error:function(){     
                    $("#msgtips").html('删除失败!');  
                    $('#my-alert').modal('open');     
                } 
            });

            },
            // closeOnConfirm: false,
          //   onCancel: function() {
          //     alert('算求，不弄了');
          // }
      });
        
    }); 

    //删除单个
    $(".delete-one").click(function(){ 
        var id = $(this).attr("value");
        var dename = $(this).attr("dename");
        if ( id == "" ) {
            $("#msgtips").html('获取id失败!');  
            $('#my-alert').modal('open');
            return;
        }
        $('.am-modal-bd').html("确定要删除 [id为"+dename+"] 这条记录？");
         
        $('#my-confirm').modal({
            relatedTarget: this,
            onConfirm: function(options) {
                $.ajax({
                 type: "POST",
                 url: "/api/svn_commits/delete",
                 cache: false,
                 data: {'ids':id},
                 dataType: "json",
                 success: function(res){
                    console.log(res);

                    if ( res.rc == 1 ) {
                        $("#msgtips").html('删除成功!');  
                        $('#my-alert').modal({
                          relatedTarget: this,
                          onConfirm: function(options) {
                             location.reload();
                          }
                        });
                    }else{
                        $("#msgtips").html('删除失败!');  
                        $('#my-alert').modal('open');       
                    }

                },
                error:function(){     
                    $("#msgtips").html('删除失败!');  
                    $('#my-alert').modal('open');     
                } 
            });

            },
            // closeOnConfirm: false,
          //   onCancel: function() {
          //     alert('算求，不弄了');
          // }
      });
        
    }); 


    //修改选中的值
    $(".checkbox").click(function(){ 
        var obj = document.getElementsByName("checkbox");//选择所有name="checked"的对象，返回数组
        var s='';//如果这样定义var s;变量s中会默认被赋个null值
        var checkarr = new Array();
        for(var i=0;i<obj.length;i++){
            if(obj[i].checked) //取到对象数组后，我们来循环检测它是不是被选中
                if (obj[i].value !== '') {
                    s+=obj[i].value+',';   //如果选中，将value添加到变量s中
                    checkarr.push(obj[i].value);
                };               
        }
        $('.have_choice').html("已选"+checkarr.length+"项");
        $('.am-modal-bd').html("确定要删除选中的"+checkarr.length+"条记录？");
    });         

    //全选和反选
    $("#SelectAll").click( 
    function(){ 
      if(this.checked){ 
        $("input[name='checkbox']").each(function(){this.checked=true;}); 
      }else{ 
        $("input[name='checkbox']").each(function(){this.checked=false;}); 
      } 
    });



    });

    </script>


    {% endblock %}
    